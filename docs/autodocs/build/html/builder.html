
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Building brain network models with BMTK Network Builder &#8212; Brain Modeling Toolkit 1.1.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=8cbc5bfe" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=58fbf978"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'builder';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Running Network Simulations with BMTK" href="simulators_guide.html" />
    <link rel="prev" title="Tutorial 6: Population Level Modeling (with PopNet)" href="tutorial_population_modeling.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.1.1" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
     
  

<a class="navbar-brand logo" href="https://alleninstitute.org/">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/allen-logo.svg" class="logo__image only-light" alt="Brain Modeling Toolkit 1.1.1 documentation - Home"/>
    <img src="_static/allen-logo.svg" class="logo__image only-dark pst-js-only" alt="Brain Modeling Toolkit 1.1.1 documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="index.html">
    About BMTK
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="news_and_events.html">
    News and Events
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="contact_us.html">
    Contact Us
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="installation.html">
    Installation Guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="tutorials.html">
    Tutorials and Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="developers_guide.html">
    For Developers
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="index.html">
    About BMTK
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="news_and_events.html">
    News and Events
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="contact_us.html">
    Contact Us
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="installation.html">
    Installation Guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="tutorials.html">
    Tutorials and Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="developers_guide.html">
    For Developers
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="tutorials.html">Tutorials and Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorial_NetworkBuilder_Intro.html">Builder: Using the Network Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_single_cell_clamped.html">BioNet: Single cell with current injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_single_cell_syn.html">BioNet: Single with with synaptic input</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_single_pop.html">BioNet: Multiple Nodes with single cell-type</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_multi_pop.html">BioNet: Heterogeneous network</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_pointnet_modeling.html">PointNet: Point-neuron modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_filter_models.html">FilterNet: Full-field flashing movie</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_auditory_filternet.html">Auditory FilterNet: Generating stimuli from auditory input</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_population_modeling.html">PopNet: Population-based firing rate models</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation Guide</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Building brain network models with BMTK Network Builder</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulators_guide.html">Running Network Simulations with BMTK</a></li>
<li class="toctree-l1"><a class="reference internal" href="analyzer.html">Analyzing the Results</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="user_guide.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Building brain network models with BMTK Network Builder</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="building-brain-network-models-with-bmtk-network-builder">
<h1>Building brain network models with BMTK Network Builder<a class="headerlink" href="#building-brain-network-models-with-bmtk-network-builder" title="Link to this heading">#</a></h1>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/bmtk_architecture_builder_highlight.jpg"><img alt="_images/bmtk_architecture_builder_highlight.jpg" src="_images/bmtk_architecture_builder_highlight.jpg" style="width: 433.6px; height: 167.20000000000002px;" />
</a>
</figure>
<p>The class for building a brain network is <code class="xref py py-class docutils literal notranslate"><span class="pre">bmtk.builder.NetworkBuilder</span></code>. This
should be used whether one is building a biophysically detailed network for BioNet, a point-neuron network for PointNet,
A filter-based lnp network for FitlerNet, or a population-level network for PopNet. In general, it can be used to build
any type of heterogeneous parameter multi-graph.</p>
<p>The process of building the network can break down into four parts:</p>
<ol class="arabic simple">
<li><p>Initialize the Network. Here all one needs is a unique name to identify the population of nodes - usually, the region
being model</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bmtk.builder</span><span class="w"> </span><span class="kn">import</span> <span class="n">NetworkBuilder</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">NetworkBuilder</span><span class="p">(</span><span class="s2">&quot;network_name&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Create the nodes (ie. cells) using the <code class="xref py py-meth docutils literal notranslate"><span class="pre">add_nodes()</span></code> method. For
different types/models of cells we can use separate calls to add_nodes (often with different model parameters).</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;Biophysical&#39;</span><span class="p">,</span> <span class="n">ei</span><span class="o">=</span><span class="s1">&#39;exc&#39;</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;IntFire&#39;</span><span class="p">,</span> <span class="n">ei</span><span class="o">=</span><span class="s1">&#39;inh&#39;</span><span class="p">,</span> <span class="n">vrest</span><span class="o">=-</span><span class="mf">50.0</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/builder_add_nodes.jpg"><img alt="_images/builder_add_nodes.jpg" src="_images/builder_add_nodes.jpg" style="width: 370.40000000000003px; height: 199.20000000000002px;" />
</a>
</figure>
<ol class="arabic simple" start="3">
<li><p>Create Connection rules between different subsets of nodes using <code class="xref py py-meth docutils literal notranslate"><span class="pre">add_edges()</span></code>
method.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ei&#39;</span><span class="p">:</span> <span class="s1">&#39;exc&#39;</span><span class="p">},</span> <span class="n">target</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ei&#39;</span><span class="p">:</span> <span class="s1">&#39;inh&#39;</span><span class="p">},</span> <span class="n">connection_rule</span><span class="o">=</span><span class="n">my_conn_func</span><span class="p">,</span> <span class="n">synaptic_model</span><span class="o">=</span><span class="s1">&#39;e2i&#39;</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ei&#39;</span><span class="p">:</span> <span class="n">inh</span><span class="p">},</span> <span class="n">target</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ei&#39;</span><span class="p">:</span> <span class="s1">&#39;exc&#39;</span><span class="p">},</span> <span class="n">connection_rule</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">synaptic_model</span><span class="o">=</span><span class="s1">&#39;i2e&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/builder_add_edges.jpg"><img alt="_images/builder_add_edges.jpg" src="_images/builder_add_edges.jpg" style="width: 366.75px; height: 254.25px;" />
</a>
</figure>
<ol class="arabic simple" start="4">
<li><p>Finally use <code class="xref py py-meth docutils literal notranslate"><span class="pre">build()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code>
methods to build and save the model to the file</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">net</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;/path/to/network/output/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/builder_complete_network.jpg"><img alt="_images/builder_complete_network.jpg" src="_images/builder_complete_network.jpg" style="width: 229.0px; height: 188.0px;" />
</a>
</figure>
<section id="building-nodes">
<h2>Building Nodes<a class="headerlink" href="#building-nodes" title="Link to this heading">#</a></h2>
<p>In BMTK and SONATA a node usually is synonymous with a cell (although a node can be used to represent a population of
cells with <a class="reference external" href="./popnet.html">PopNet</a>). To add a group of nodes to a network is to use the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">NetworkBuilder.add_nodes()</span></code>.</p>
<p>The only thing that is required is an integer value N for the number of individual nodes. The modeler can also pass in
any parameter they want to describe their model - although SONATA/BMTK does contain a number of reserved node parameters
that will be useful in generating an instantiable model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;biophysical&#39;</span><span class="p">,</span> <span class="n">dynamics_params</span><span class="o">=</span><span class="s1">&#39;rorb_params.json&#39;</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="s1">&#39;rorb.swc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above example, all 100 nodes share the same values for <code class="docutils literal notranslate"><span class="pre">model_type</span></code>, <code class="docutils literal notranslate"><span class="pre">dynamics_params</span></code>, and <code class="docutils literal notranslate"><span class="pre">morphology</span></code>.
To have unique parameter values for each N node you only need to pass in a list or array of size N. In the below example
the <code class="docutils literal notranslate"><span class="pre">rotation_angle_xaxis</span></code> and <code class="docutils literal notranslate"><span class="pre">rotation_angle_yaxis</span></code> will be unique for every node</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
   <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
   <span class="n">rotation_angle_xaxis</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
   <span class="n">rotation_angle_yaxis</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
   <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;biophysical&#39;</span><span class="p">,</span>
   <span class="o">...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>If a parameter requires compounded data you can use a tuple or a list of tuples. For example, we may want to represent a
cell’s position by a range:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">pos_with_jitter</span><span class="o">=</span><span class="p">[(</span><span class="n">p</span><span class="o">-</span><span class="n">rand</span><span class="p">(),</span> <span class="n">p</span><span class="o">+</span><span class="n">rand</span><span class="p">())</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">],</span>
        <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<section id="node-representation">
<h3>Node Representation<a class="headerlink" href="#node-representation" title="Link to this heading">#</a></h3>
<p>When <code class="xref py py-meth docutils literal notranslate"><span class="pre">NetworkBuilder.build()</span></code> is called, each node will be given a unique
<strong>node_id</strong> value, and each type model (eg each call to add_nodes) will also be given a <strong>node_type_id</strong>. It is possible
to set the <strong>node_id</strong> and <strong>node_type_id</strong> parameter yourself but it’s generally not a good idea.</p>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">NetworkBuilder.nodes()</span></code> will return an iterator of the nodes in a
network. By default, it returns all nodes but one can filter by specific property values. The nodes themselves can have
their properties accessed like a dictionary. For example to get all biophysically detailed inh neurons:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;biophysical&#39;</span><span class="p">,</span> <span class="n">ei</span><span class="o">=</span><span class="s1">&#39;inh&#39;</span><span class="p">):</span>
   <span class="n">x</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s1">&#39;position_x&#39;</span><span class="p">]</span>
   <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="useful-node-parameters">
<h3>Useful Node Parameters<a class="headerlink" href="#useful-node-parameters" title="Link to this heading">#</a></h3>
<p>As mentioned above the modeler can use any parameters and values they require to represent their models. The following
are parameters that will be recognized and used by the BMTK simulator (but not necessarily required). For a complete
list see <a class="reference external" href="https://github.com/AllenInstitute/sonata/blob/master/docs/SONATA_DEVELOPER_GUIDE.md#nodes---required-attributes">SONATA</a>:</p>
<div class="pst-scrollable-table-container"><table class="table">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>x (or y, z)</p></td>
<td><p>x positions of soma in world coordinates</p></td>
</tr>
<tr class="row-odd"><td><p>rotation_angle_xaxis (or y, z)</p></td>
<td><p>rotation of the morphology around the soma</p></td>
</tr>
<tr class="row-even"><td><p>model_type</p></td>
<td><p>level of representation of neurons (biophysical, point_neuron, virtual)</p></td>
</tr>
<tr class="row-odd"><td><p>model_template</p></td>
<td><p>String name of the template to create (eg, ctdb:Biophys1.hoc, nest:glif_lif, etc)</p></td>
</tr>
<tr class="row-even"><td><p>model_processing</p></td>
<td><p>Directive or function that will be applied to neuron model after creation. For Allen Cell Types models use aibs_perisomatic or aibs_allactive</p></td>
</tr>
<tr class="row-odd"><td><p>dynamics_params</p></td>
<td><p>Channel and mechanism parameters for neuron, usually a name of a json or NeuronML file. Will overwrite model_template.</p></td>
</tr>
<tr class="row-even"><td><p>morphology</p></td>
<td><p>Name of the detailed morphology file (usually SWC).</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="building-edges">
<h2>Building Edges<a class="headerlink" href="#building-edges" title="Link to this heading">#</a></h2>
<p>To define different types of edges between two subsets of nodes you should use the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">NetworkBuilder.add_edges()</span></code> method. Then once
<code class="xref py py-meth docutils literal notranslate"><span class="pre">NetworkBuilder.build()</span></code> method is called the the actual connections will
be instantiated based on the <strong>connectivity_rule</strong> property the user defines. A typical call to add_edges would be the following</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span>
      <span class="n">source</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ei&#39;</span><span class="p">:</span> <span class="s1">&#39;inh&#39;</span><span class="p">},</span>                                 <span class="c1"># 1</span>
      <span class="n">target</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ei&#39;</span><span class="p">:</span> <span class="s1">&#39;exc&#39;</span><span class="p">,</span> <span class="s1">&#39;ephys_type&#39;</span><span class="p">:</span> <span class="s1">&#39;fast_spiking&#39;</span><span class="p">},</span>
      <span class="n">connection_rule</span><span class="o">=</span><span class="n">my_connection_func</span><span class="p">,</span>                   <span class="c1"># 2</span>
      <span class="n">dynamic_parameters</span><span class="o">=</span><span class="s1">&#39;i2e.json&#39;</span><span class="p">,</span>                        <span class="c1"># 3</span>
      <span class="n">synaptic_model</span><span class="o">=</span><span class="s1">&#39;alphaSyn&#39;</span><span class="p">,</span>
      <span class="n">syn_weight</span><span class="o">=</span><span class="mf">1.34e-05</span><span class="p">,</span>
      <span class="n">delay</span><span class="o">=</span><span class="mf">2.0</span>
<span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>parameters <code class="docutils literal notranslate"><span class="pre">source</span></code> and <code class="docutils literal notranslate"><span class="pre">target</span></code> are used to filter out the subset of nodes used pre-and post-synapse, respectively.
In this case, the source population consists of all inhibitory (ei=inh) neurons, while the target population consists
only of excitatory (ei=exc) fast-spiking neurons. If the source or target is not specified then all possible nodes will
be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">connection_rule</span></code> is used to determine the number of connections between each source and the target node. If the value
is given as an integer N then all possible source/target pairs with have N different connections. You can also pass
in a list-of-list or a matrix. But usually, a user-defined function is used, which will be better described in the
next section.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dynamic_parameters</span></code>, <code class="docutils literal notranslate"><span class="pre">synaptic_model</span></code>, <code class="docutils literal notranslate"><span class="pre">syn_weight</span></code>, and <code class="docutils literal notranslate"><span class="pre">delay</span></code> are all shared connection parameters. Like
with nodes, modelers can choose whatever parameters they deem best to represent their network. A list of useful
parameters pre-defined by BMTK and SONATA is described below.</p></li>
</ol>
<p>Also, like the nodes, it is possible to have unique values for every individual edge, but it is a little more difficult.
See the section on ConnectionMap for more info.</p>
<section id="connection-rules">
<h3>Connection rules<a class="headerlink" href="#connection-rules" title="Link to this heading">#</a></h3>
<p>The connection_rule parameter of add_edges() method will usually be a user-defined function (but may also be an integer,
list-of-lists, or matrix). The function’s first two parameters will be source and target, Node objects whose properties
can be accessed like a dictionary. It should return an integer N for the number of connections between the source and
target, 0 or None if there is no connection.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">my_connection_func</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
   <span class="n">src_pos</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span>
   <span class="n">trg_pos</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span>
   <span class="o">...</span>
   <span class="k">return</span> <span class="n">N_syns</span>

<span class="n">net</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span>
   <span class="n">source</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ei&#39;</span><span class="p">:</span> <span class="s1">&#39;inh&#39;</span><span class="p">},</span> <span class="n">target</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ei&#39;</span><span class="p">:</span> <span class="s1">&#39;exc&#39;</span><span class="p">,</span> <span class="s1">&#39;ephys_type&#39;</span><span class="p">:</span> <span class="s1">&#39;fast_spiking&#39;</span><span class="p">},</span>
   <span class="n">connection_rule</span><span class="o">=</span><span class="n">my_connection_func</span><span class="p">,</span>
   <span class="n">dynamic_parameters</span><span class="o">=</span><span class="s1">&#39;i2e.json&#39;</span><span class="p">,</span>
   <span class="o">...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>If the connection_rule function requires additional arguments, use the connection_params option:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">my_connection_func</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">min_edges</span><span class="p">,</span> <span class="n">max_edges</span><span class="p">):</span>
   <span class="n">src_pos</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span>
   <span class="n">trg_pos</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span>
   <span class="o">...</span>
   <span class="k">return</span> <span class="n">N_syns</span>

<span class="n">net</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span>
   <span class="n">source</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ei&#39;</span><span class="p">:</span> <span class="s1">&#39;inh&#39;</span><span class="p">},</span> <span class="n">target</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ei&#39;</span><span class="p">:</span> <span class="s1">&#39;exc&#39;</span><span class="p">,</span> <span class="s1">&#39;ephys_type&#39;</span><span class="p">:</span> <span class="s1">&#39;fast_spiking&#39;</span><span class="p">},</span>
   <span class="n">connection_rule</span><span class="o">=</span><span class="n">my_connection_func</span><span class="p">,</span>
   <span class="n">connection_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;min_edges&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;max_edges&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span>
   <span class="n">dynamic_parameters</span><span class="o">=</span><span class="s1">&#39;i2e.json&#39;</span><span class="p">,</span>
   <span class="o">...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>When <code class="xref py py-meth docutils literal notranslate"><span class="pre">NetworkBuilder.build()</span></code> is executed my_connection_func() will be
automatically called for all possible source/target pair of nodes and the connectivity matrix will be called.</p>
<p>Sometimes it may be more efficient or necessary to set all incoming (or outgoing) connections in one function. For
example, we may need to limit the total number of synapses on a target. The <code class="docutils literal notranslate"><span class="pre">iterator</span></code> parameter allows the modeler to
change the signature and return values of their connection_rule function. By setting <code class="docutils literal notranslate"><span class="pre">iterator</span></code> to <strong>all_to_one</strong>,
instead of passing in a single source neuron it will pass in a list of all N source neurons, and will expect a
corresponding list of size N</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">bulk_connection_func</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
   <span class="n">trg_pos</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span>
   <span class="n">syn_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sources</span><span class="p">))</span>
   <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">:</span>
      <span class="n">src_pos</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span>
      <span class="o">...</span>
   <span class="k">return</span> <span class="n">syn_list</span>
</pre></div>
</div>
<p>There is also an <strong>all_to_one</strong> iterator option that will pair each source node with a list of all available target nodes.</p>
</section>
<section id="individual-edge-properties-the-connectionmap">
<h3>Individual Edge Properties (The ConnectionMap)<a class="headerlink" href="#individual-edge-properties-the-connectionmap" title="Link to this heading">#</a></h3>
<p>Sometimes it is necessary for each edge to have unique property values. For example, the individual syn_weight value for
each synapse may vary depending on the location and type of the pre-and post-synaptic nodes. With nodes,
you can pass in a list or array of size N for each N node. But when edges are built using a connection_rule function
the exact number of connections will not be known in advance.</p>
<p>each call to add_edges returns a <a class="reference internal" href="bmtk/bmtk.builder.html#bmtk.builder.connection_map.ConnectionMap" title="bmtk.builder.connection_map.ConnectionMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionMap</span></code></a> object. The
<a class="reference internal" href="bmtk/bmtk.builder.html#bmtk.builder.connection_map.ConnectionMap.add_properties" title="bmtk.builder.connection_map.ConnectionMap.add_properties"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionMap.add_properties()</span></code></a> method allows us to
add individual properties for each edge using our own user defined functions. Like with our connection_rule function,
the connection_map <code class="docutils literal notranslate"><span class="pre">rule</span></code> function takes in a source and target node and returns a corresponding value:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">set_syn_weight_by_dist</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
   <span class="n">src_pos</span><span class="p">,</span> <span class="n">trg_pos</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span>
   <span class="o">...</span>
   <span class="k">return</span> <span class="n">syn_weight</span>

<span class="n">cm</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span><span class="o">....</span><span class="p">)</span>
<span class="n">cm</span><span class="o">.</span><span class="n">add_properties</span><span class="p">(</span><span class="s1">&#39;syn_weight&#39;</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">set_syn_weight_by_dist</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">cm</span><span class="o">.</span><span class="n">add_properties</span><span class="p">(</span><span class="s1">&#39;delay&#39;</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">),</span> <span class="n">dtypes</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">rule</span></code> requires extra arguments we can use the <code class="docutils literal notranslate"><span class="pre">rule_params</span></code> option:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">set_syn_weight_by_dist</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">min_weight</span><span class="p">,</span> <span class="n">max_weight</span><span class="p">):</span>
   <span class="n">src_pos</span><span class="p">,</span> <span class="n">trg_pos</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span>
   <span class="o">...</span>
   <span class="k">return</span> <span class="n">syn_weight</span>

<span class="n">cm</span><span class="o">.</span><span class="n">add_properties</span><span class="p">(</span>
   <span class="n">name</span><span class="o">=</span><span class="s1">&#39;syn_weight&#39;</span><span class="p">,</span>
   <span class="n">rule</span><span class="o">=</span><span class="n">set_syn_weight_by_dist</span><span class="p">,</span>
   <span class="n">rule_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;min_weight&#39;</span><span class="p">:</span> <span class="mf">1.0e-06</span><span class="p">,</span> <span class="s1">&#39;max_weight&#39;</span><span class="p">:</span> <span class="mf">1.0e-04</span><span class="p">},</span>
   <span class="n">dtypes</span><span class="o">=</span><span class="nb">float</span>
<span class="p">)</span>
</pre></div>
</div>
<p>It is also possible to set multiple parameters in a single function. For example, for each synapse, we may want to set
the distance between the soma, and the neuronal area (soma, apical dendrites, basal dendrites, etc). To do so our <code class="docutils literal notranslate"><span class="pre">name</span></code>
and <code class="docutils literal notranslate"><span class="pre">dtypes</span></code> parameters take a list, and our rule function now returns two values</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">set_target_location</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
   <span class="o">...</span>
   <span class="k">return</span> <span class="n">syn_region</span><span class="p">,</span> <span class="n">syn_dist</span>

<span class="n">cm</span><span class="o">.</span><span class="n">add_properties</span><span class="p">(</span>
   <span class="n">name</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;syn_region&#39;</span><span class="p">,</span> <span class="s1">&#39;syn_dist&#39;</span><span class="p">],</span>
   <span class="n">rule</span><span class="o">=</span><span class="n">set_syn_weight_by_dist</span><span class="p">,</span>
   <span class="n">dtypes</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="intra-network-connections">
<h3>Intra-Network Connections<a class="headerlink" href="#intra-network-connections" title="Link to this heading">#</a></h3>
<p>Both BMTK and SONATA support a network to be built piecemeal and combined into one at simulation time. A cortical
the region will receive inputs from many other regions, and a modeler may want to test the dynamics when different
combinations of inputs are turned on and off. Instead of building multiple models of the region with different inputs,
instead, we can build the nodes, recurrent and inter-network connections each region independently and turn them on and
off during the simulation (see <a class="reference external" href="./simulators.html#configuration-files">simulation config</a>)</p>
<p>Creating connections between two different networks is very similar to creating recurrent connections and still use the
add_edges method. The main difference is for our <code class="docutils literal notranslate"><span class="pre">source</span></code> or <code class="docutils literal notranslate"><span class="pre">target</span></code> argument, instead of using a dictionary we must
use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">NetworkBuilder.nodes()</span></code> method of another network. For example, we
have two networks called <strong>LGN</strong> and <strong>V1</strong> and we want to create a connection type from LGN’s excitatory neurons (ei=exc)
V1’s pyramidal cells</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">v1</span> <span class="o">=</span> <span class="n">NetworkBuilder</span><span class="p">(</span><span class="s1">&#39;V1&#39;</span><span class="p">)</span>
<span class="o">...</span> <span class="c1"># Build V1 network</span>

<span class="n">lgn</span> <span class="o">=</span> <span class="n">NetworkBuilder</span><span class="p">(</span><span class="s1">&#39;LGN&#39;</span><span class="p">)</span>
<span class="n">lgn</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">30000</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;virtual&#39;</span><span class="p">,</span> <span class="n">ei</span><span class="o">=</span><span class="s1">&#39;exc&#39;</span><span class="p">)</span>
<span class="n">lgn</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span>
   <span class="n">source</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ei&#39;</span><span class="p">:</span> <span class="s1">&#39;exc&#39;</span><span class="p">},</span>                  <span class="c1"># dict indicates source population coming from lgn_net</span>
   <span class="n">target</span><span class="o">=</span><span class="n">v1</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="s1">&#39;model_type&#39;</span><span class="p">:</span> <span class="s1">&#39;pyr&#39;</span><span class="p">),</span>  <span class="c1"># target population coming form V1 network</span>
   <span class="n">connection_rule</span><span class="o">=</span><span class="n">input_conn_fnc</span><span class="p">,</span>
   <span class="o">...</span>
<span class="p">)</span>
<span class="n">lgn</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>When creating intra-network connections the <code class="xref py py-meth docutils literal notranslate"><span class="pre">NetworkBuilder.import()</span></code>
method can be very useful.</p>
</section>
<section id="edge-accessor-methods">
<h3>Edge Accessor methods<a class="headerlink" href="#edge-accessor-methods" title="Link to this heading">#</a></h3>
<section id="networkbuilder-edges">
<h4><code class="xref py py-meth docutils literal notranslate"><span class="pre">NetworkBuilder.edges()</span></code><a class="headerlink" href="#networkbuilder-edges" title="Link to this heading">#</a></h4>
<p>The method will return an iterator of edges filtered by edge and/or node properties. Each edge will be
represented using a <a class="reference internal" href="bmtk/bmtk.builder.html#bmtk.builder.edge.Edge" title="bmtk.builder.edge.Edge"><code class="xref py py-class docutils literal notranslate"><span class="pre">Edge</span></code></a> object</p>
</section>
</section>
<section id="useful-edge-parameters">
<h3>Useful Edge Parameters<a class="headerlink" href="#useful-edge-parameters" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>syn_weight</p></td>
<td><p>synaptic weight</p></td>
</tr>
<tr class="row-odd"><td><p>delay</p></td>
<td><p>synaptic delay, in ms</p></td>
</tr>
<tr class="row-even"><td><p>model_template</p></td>
<td><p>String name of the template to create an object from parameters in dynamics_params</p></td>
</tr>
<tr class="row-odd"><td><p>dynamics_params</p></td>
<td><p>dynamic parameter overrides for edges</p></td>
</tr>
<tr class="row-even"><td><p>efferent_section_id</p></td>
<td><p>location of (NEURON) section where the connection will target</p></td>
</tr>
<tr class="row-odd"><td><p>efferent_section_pos</p></td>
<td><p>distance within the (NEURON) section where synapse will target</p></td>
</tr>
<tr class="row-even"><td><p>target_sections</p></td>
<td><p>A list of neuronal sections where the synapse will target (soma, axon, apical, basal). When used in place of section_id, BioNet will randomly select a section on the target neuron</p></td>
</tr>
<tr class="row-odd"><td><p>distance_range</p></td>
<td><p>A range in um of the distance from the soma, used along with target_sections param to randomly target certain areas of the post-synaptic neuron.</p></td>
</tr>
<tr class="row-even"><td><p>weight_function</p></td>
<td><p>Name of the detailed morphology file (usually SWC).</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="saving-and-building">
<h2>Saving and Building<a class="headerlink" href="#saving-and-building" title="Link to this heading">#</a></h2>
<p>Once all calls to add_nodes and ad_edges have been made, use the build() method to actually complete and fully
instantiate the network. Certain accessor functions, like
<code class="xref py py-meth docutils literal notranslate"><span class="pre">NetworkBuilder.nodes()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">NetworkBuilder.edges()</span></code> will not work until all the edges have been
completed. Depending on the size of the network and the complexity of the connectivity rules, it can take anywhere from
less than a second to days to build the full model.</p>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">NetworkBuilder.save(output_dir=’/path/to/output/net/’)</span></code> method will
write the network to a disk in SONATA format at the given output_dir path. By default nodes and edges will be written to
different files using the network names to determine the sonata file names. The
<code class="xref py py-meth docutils literal notranslate"><span class="pre">NetworkBuilder.save_nodes()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">NetworkBuilder.save_edges()</span></code> functions may also used to only write
out the nodes or the edges, respectively.</p>
</section>
<section id="network-format">
<h2>Network Format<a class="headerlink" href="#network-format" title="Link to this heading">#</a></h2>
<p>This is a brief overview of how NetworkBuilder saves the network’s nodes and edges files. As mentioned BMTK uses the
SONATA format, so more in-depth descriptions may be
<a class="reference external" href="https://github.com/AllenInstitute/sonata/blob/master/docs/SONATA_DEVELOPER_GUIDE.md#representing-networks-of-neurons">found here</a>.
Opening the HDF5 file will require a hdf browser like HDFView, or a library like h5py. You can also use
<a class="reference external" href="https://github.com/AllenInstitute/sonata/tree/master/src/pysonata">pySONATA</a> or
<a class="reference external" href="https://github.com/BlueBrain/libsonata">libSONATA</a> which are API’s for reading in SONATA files</p>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/sonata_structure.jpg"><img alt="_images/sonata_structure.jpg" src="_images/sonata_structure.jpg" style="width: 732.6px; height: 363.6px;" />
</a>
</figure>
</section>
<section id="advanced-features">
<h2>Advanced Features<a class="headerlink" href="#advanced-features" title="Link to this heading">#</a></h2>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-nodes">Building Nodes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#node-representation">Node Representation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#useful-node-parameters">Useful Node Parameters</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-edges">Building Edges</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#connection-rules">Connection rules</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#individual-edge-properties-the-connectionmap">Individual Edge Properties (The ConnectionMap)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#intra-network-connections">Intra-Network Connections</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#edge-accessor-methods">Edge Accessor methods</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#networkbuilder-edges"><code class="xref py py-meth docutils literal notranslate"><span class="pre">NetworkBuilder.edges()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#useful-edge-parameters">Useful Edge Parameters</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-and-building">Saving and Building</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#network-format">Network Format</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-features">Advanced Features</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/builder.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>